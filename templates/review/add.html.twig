{% extends 'base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link href="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-star-rating@4.1.2/css/star-rating.min.css" media="all" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-star-rating@4.1.2/themes/krajee-svg/theme.css" media="all" rel="stylesheet" type="text/css" />
{% endblock %}

{% block body %}
    {{ parent() }}
    <div class="container">
        <div class="row">
            <div class="col m-5 bg-light rounded-5">
                <div class="m-3">
                    {{ form_start(form) }}
                        <div class="mb-3">
                            {{ form_label(form.name) }}
                            {{ form_widget(form.name) }}
                        </div>
                        <div class="mb-3">
                            {{ form_label(form.reviewGroup) }}
                            {{ form_widget(form.reviewGroup) }}
                        </div>
                        <div>
                            <div class="tags mb-3"
                                data-index="{{ form.tags|length > 0 ? form.tags|last.vars.name + 1 : 0 }}"
                                data-prototype="{{ form_widget(form.tags.vars.prototype)|e('html_attr') }}">
                                {{ form_label(form.tags) }}
                                {% for tag in form.tags %}
                                    {{ form_row(tag) }}
                                {% endfor %}
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-primary mb-3 add_item_link" data-collection-holder-class="tags">{{ 'Add a tag'|trans }}</button>
                        </div>
                        <div class="mb-3">
                            {{ form_label(form.rating) }}
                            {{ form_widget(form.rating) }}
                        </div>
                        <div class="mb-3">
                            {{ form_label(form.text, 'Text'|trans) }}
                            {{ form_widget(form.text) }}
                        </div>
                        {{ form_label(form.submit, 'Submit'|trans) }}
                        {{ form_widget(form.submit) }}
                    {{ form_end(form) }}
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-star-rating@4.1.2/js/star-rating.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-star-rating@4.1.2/themes/krajee-svg/theme.js"></script>
    <script>
        const addTagFormDeleteLink = (item) => {
            const removeFormButton = document.createElement('button');
            removeFormButton.className = "btn btn-sm btn-outline-danger";
            removeFormButton.innerText = '{{ 'Delete this tag'|trans }}';

            item.append(removeFormButton);

            removeFormButton.addEventListener('click', (e) => {
                e.preventDefault();
                item.remove();
            });
        }
        document.querySelectorAll('div.tags fieldset').forEach((tag) => {
            addTagFormDeleteLink(tag);
        });
    </script>
    <script>
        const addFormToCollection = (e) => {
            const collectionHolder = document.querySelector('.' + e.currentTarget.dataset.collectionHolderClass);
            console.log('e');
            const item = document.createElement('div');

            item.innerHTML = collectionHolder
                .dataset
                .prototype
                .replace(
                    /__name__/g,
                    collectionHolder.dataset.index
                );

            collectionHolder.appendChild(item);

            collectionHolder.dataset.index++;
            addTagFormDeleteLink(item);
        };
        document
            .querySelectorAll('.add_item_link')
            .forEach(btn => {
                btn.addEventListener("click", addFormToCollection);
                console.log('query selector is working');
            });
    </script>
{% endblock %}